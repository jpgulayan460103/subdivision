"use strict";const strictUriEncode=require("strict-uri-encode"),decodeComponent=require("decode-uri-component"),splitOnFirst=require("split-on-first"),filterObject=require("filter-obj"),isNullOrUndefined=e=>null==e,encodeFragmentIdentifier=Symbol("encodeFragmentIdentifier");function encoderForArrayFormat(o){switch(o.arrayFormat){case"index":return a=>(e,r)=>{const t=e.length;return void 0===r||o.skipNull&&null===r||o.skipEmptyString&&""===r?e:null===r?[...e,[encode(a,o),"[",t,"]"].join("")]:[...e,[encode(a,o),"[",encode(t,o),"]=",encode(r,o)].join("")]};case"bracket":return t=>(e,r)=>void 0===r||o.skipNull&&null===r||o.skipEmptyString&&""===r?e:null===r?[...e,[encode(t,o),"[]"].join("")]:[...e,[encode(t,o),"[]=",encode(r,o)].join("")];case"comma":case"separator":case"bracket-separator":{const a="bracket-separator"===o.arrayFormat?"[]=":"=";return t=>(e,r)=>void 0===r||o.skipNull&&null===r||o.skipEmptyString&&""===r?e:(r=null===r?"":r,0===e.length?[[encode(t,o),a,encode(r,o)].join("")]:[[e,encode(r,o)].join(o.arrayFormatSeparator)])}default:return t=>(e,r)=>void 0===r||o.skipNull&&null===r||o.skipEmptyString&&""===r?e:null===r?[...e,encode(t,o)]:[...e,[encode(t,o),"=",encode(r,o)].join("")]}}function parserForArrayFormat(n){let a;switch(n.arrayFormat){case"index":return(e,r,t)=>{a=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),a?(void 0===t[e]&&(t[e]={}),t[e][a[1]]=r):t[e]=r};case"bracket":return(e,r,t)=>{a=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),a?void 0!==t[e]?t[e]=[].concat(t[e],r):t[e]=[r]:t[e]=r};case"comma":case"separator":return(e,r,t)=>{var a="string"==typeof r&&r.includes(n.arrayFormatSeparator),o="string"==typeof r&&!a&&decode(r,n).includes(n.arrayFormatSeparator);r=o?decode(r,n):r;r=a||o?r.split(n.arrayFormatSeparator).map(e=>decode(e,n)):null===r?r:decode(r,n);t[e]=r};case"bracket-separator":return(e,r,t)=>{var a=/(\[\])$/.test(e);e=e.replace(/\[\]$/,""),a?(a=null===r?[]:r.split(n.arrayFormatSeparator).map(e=>decode(e,n)),void 0!==t[e]?t[e]=[].concat(t[e],a):t[e]=a):t[e]=r&&decode(r,n)};default:return(e,r,t)=>{void 0!==t[e]?t[e]=[].concat(t[e],r):t[e]=r}}}function validateArrayFormatSeparator(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function encode(e,r){return r.encode?(r.strict?strictUriEncode:encodeURIComponent)(e):e}function decode(e,r){return r.decode?decodeComponent(e):e}function keysSorter(r){return Array.isArray(r)?r.sort():"object"==typeof r?keysSorter(Object.keys(r)).sort((e,r)=>Number(e)-Number(r)).map(e=>r[e]):r}function removeHash(e){var r=e.indexOf("#");return e=-1!==r?e.slice(0,r):e}function getHash(e){let r="";var t=e.indexOf("#");return-1!==t&&(r=e.slice(t)),r}function extract(e){var r=(e=removeHash(e)).indexOf("?");return-1===r?"":e.slice(r+1)}function parseValue(e,r){return r.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!r.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function parse(e,t){validateArrayFormatSeparator((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const a=parserForArrayFormat(t),o=Object.create(null);if("string"!=typeof e)return o;if(!(e=e.trim().replace(/^[?#&]/,"")))return o;for(const n of e.split("&"))if(""!==n){let[e,r]=splitOnFirst(t.decode?n.replace(/\+/g," "):n,"=");r=void 0===r?null:["comma","separator","bracket-separator"].includes(t.arrayFormat)?r:decode(r,t),a(decode(e,t),r,o)}for(const r of Object.keys(o)){const s=o[r];if("object"==typeof s&&null!==s)for(const i of Object.keys(s))s[i]=parseValue(s[i],t);else o[r]=parseValue(s,t)}return!1===t.sort?o:(!0===t.sort?Object.keys(o).sort():Object.keys(o).sort(t.sort)).reduce((e,r)=>{var t=o[r];return Boolean(t)&&"object"==typeof t&&!Array.isArray(t)?e[r]=keysSorter(t):e[r]=t,e},Object.create(null))}exports.extract=extract,exports.parse=parse,exports.stringify=(t,a)=>{if(!t)return"";validateArrayFormatSeparator((a=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},a)).arrayFormatSeparator);var e;const o=encoderForArrayFormat(a),r={};for(const s of Object.keys(t))e=s,a.skipNull&&isNullOrUndefined(t[e])||a.skipEmptyString&&""===t[e]||(r[s]=t[s]);const n=Object.keys(r);return!1!==a.sort&&n.sort(a.sort),n.map(e=>{const r=t[e];return void 0===r?"":null===r?encode(e,a):Array.isArray(r)?0===r.length&&"bracket-separator"===a.arrayFormat?encode(e,a)+"[]":r.reduce(o(e),[]).join("&"):encode(e,a)+"="+encode(r,a)}).filter(e=>0<e.length).join("&")},exports.parseUrl=(e,r)=>{r=Object.assign({decode:!0},r);const[t,a]=splitOnFirst(e,"#");return Object.assign({url:t.split("?")[0]||"",query:parse(extract(e),r)},r&&r.parseFragmentIdentifier&&a?{fragmentIdentifier:decode(a,r)}:{})},exports.stringifyUrl=(e,r)=>{r=Object.assign({encode:!0,strict:!0,[encodeFragmentIdentifier]:!0},r);var t=removeHash(e.url).split("?")[0]||"",a=exports.extract(e.url),a=exports.parse(a,{sort:!1}),a=Object.assign(a,e.query);let o=exports.stringify(a,r);o=o&&`?${o}`;let n=getHash(e.url);return e.fragmentIdentifier&&(n=`#${r[encodeFragmentIdentifier]?encode(e.fragmentIdentifier,r):e.fragmentIdentifier}`),`${t}${o}${n}`},exports.pick=(e,r,t)=>{t=Object.assign({parseFragmentIdentifier:!0,[encodeFragmentIdentifier]:!1},t);var{url:a,query:o,fragmentIdentifier:e}=exports.parseUrl(e,t);return exports.stringifyUrl({url:a,query:filterObject(o,r),fragmentIdentifier:e},t)},exports.exclude=(e,t,r)=>{var a=Array.isArray(t)?e=>!t.includes(e):(e,r)=>!t(e,r);return exports.pick(e,a,r)};